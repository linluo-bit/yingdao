# 元素捕获功能使用说明

## 功能概述

元素捕获功能允许你在RPA应用中通过Chrome插件快速获取网页元素的选择器，无需手动输入。

## 安装步骤

### 1. 安装Chrome插件

1. 打开Chrome浏览器
2. 在地址栏输入：`chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目中的 `chrome-extension` 文件夹
6. 插件安装完成，会在工具栏显示图标

### 2. 验证插件安装

- 插件图标应该出现在Chrome工具栏
- 点击插件图标应该能看到弹窗界面
- 在任意网页上按住Ctrl键应该能看到鼠标变成十字形

## 使用方法

### 在RPA应用中使用

1. **打开RPA应用**
   - 运行 `python main.py`

2. **创建工作流**
   - 从左侧指令面板拖拽"点击元素(web)"到画布
   - 双击该指令打开配置对话框

3. **配置元素选择**
   - 选择选择器类型（CSS、XPath、ID、Name）
   - 点击"🔍 捕获元素"按钮

4. **在浏览器中捕获元素**
   - 按照提示切换到浏览器窗口
   - 按住Ctrl键进入捕获模式
   - 鼠标悬停时会高亮显示元素
   - 按住Ctrl+鼠标左键点击要捕获的元素
   - 会看到捕获成功的提示

5. **返回RPA应用**
   - 回到RPA应用，选择器会自动填入
   - 点击"确定"完成配置

### 在浏览器中直接使用

1. **启动捕获模式**
   - 方法1：按住Ctrl键
   - 方法2：点击插件图标，然后点击"开始捕获"

2. **捕获元素**
   - 鼠标悬停会高亮显示元素
   - 按住Ctrl+鼠标左键点击要捕获的元素
   - 会显示捕获成功的提示

3. **查看捕获结果**
   - 点击插件图标查看捕获的元素列表
   - 可以导出数据或清空列表

## 技术原理

### 数据流程

1. **Chrome插件捕获元素**
   - 用户在浏览器中点击元素
   - 插件获取元素的详细信息（标签名、ID、类名、XPath等）
   - 保存到Chrome本地存储

2. **数据传递**
   - 插件将捕获的元素信息保存为JSON文件
   - 文件保存到下载文件夹或项目目录
   - RPA应用读取这些文件获取元素信息

3. **RPA应用处理**
   - RPA应用扫描指定目录查找最新的捕获文件
   - 解析JSON文件获取元素信息
   - 根据选择器类型自动填入相应的选择器

### 文件结构

```
项目目录/
├── chrome-extension/          # Chrome插件
│   ├── manifest.json         # 插件配置
│   ├── content.js           # 元素捕获逻辑
│   ├── background.js        # 后台管理
│   └── popup.html          # 插件界面
├── captured_elements/        # 捕获的元素文件
│   └── *.json              # 捕获的元素数据
└── main.py                  # RPA主程序
```

## 捕获的元素信息

每个捕获的元素包含以下信息：

```json
{
  "tagName": "button",           // 标签名
  "id": "login-button",          // 元素ID
  "className": "btn btn-primary", // 类名
  "text": "登录",                // 文本内容
  "xpath": "//button[@id='login-button']", // XPath
  "cssSelector": "#login-button", // CSS选择器
  "position": {                  // 位置信息
    "x": 100,
    "y": 200,
    "width": 80,
    "height": 40
  },
  "attributes": {                // 属性信息
    "type": "submit",
    "name": "login",
    "value": "登录"
  },
  "timestamp": "2024-01-01T12:00:00.000Z", // 时间戳
  "url": "https://example.com/login"       // 页面URL
}
```

## 故障排除

### 常见问题

1. **插件无法安装**
   - 确保开启了开发者模式
   - 检查插件文件夹是否完整
   - 尝试重启Chrome浏览器

2. **捕获功能不工作**
   - 确保插件已启用
   - 检查是否在HTTP/HTTPS页面
   - 尝试刷新页面后重试

3. **RPA应用无法读取捕获数据**
   - 检查文件权限
   - 确认捕获时间在5分钟内
   - 查看控制台错误信息

4. **选择器不准确**
   - 尝试不同的选择器类型
   - 检查元素是否有动态ID
   - 使用更具体的选择器

### 调试方法

1. **查看Chrome控制台**
   - 按F12打开开发者工具
   - 查看Console标签页的错误信息

2. **检查插件状态**
   - 点击插件图标查看状态
   - 检查badge数字是否更新

3. **验证文件生成**
   - 检查下载文件夹是否有JSON文件
   - 查看文件内容是否正确

## 高级功能

### 批量捕获

1. 在插件弹窗中点击"开始捕获"
2. 连续捕获多个元素
3. 点击"导出数据"保存所有元素

### 自定义选择器

1. 捕获元素后查看详细信息
2. 根据元素属性手动优化选择器
3. 在RPA应用中手动输入优化后的选择器

### 元素验证

1. 在RPA应用中配置元素后
2. 运行测试验证选择器是否正确
3. 如有问题重新捕获元素

## 更新日志

### v1.1.0
- 集成元素捕获功能到点击元素指令
- 实现Chrome插件与RPA应用的通信
- 支持多种选择器类型
- 添加文件自动保存和读取功能

### v1.0.0
- 基础Chrome插件功能
- 元素高亮和捕获
- 数据导出功能 